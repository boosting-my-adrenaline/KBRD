import React, { useState, useEffect, useRef } from 'react'
import { KBRD } from './KBRD'
import { letter1, letter2, startLetter } from '../../static/letters'

export interface ILETTER {
  value: string
  error: boolean
}

export const KBRDContainer: React.FC = () => {
  const [ARRAY, setARRAY] = useState<ILETTER[]>(startLetter)

  const [test, setTest] = useState(0)

  const [keyDown, setKeyDown] = useState('')
  const [lamp, setLamp] = useState(0)

  const rendersCount = useRef(1)

  useEffect(() => {
    rendersCount.current++
  })

  useEffect(() => {
    setARRAY(
      letter1
        .toLowerCase()
        .split('')
        .map((el) => ({ value: el, error: false }))
    )
  }, [])

  useEffect(() => {
    if (keyDown === ARRAY[0].value) {
      setARRAY((arr) => {
        arr.push(arr.shift() as ILETTER)

        return arr
      })
      setTest((test) => test + 1)
    }
  }, [keyDown])

  useEffect(() => {
    setARRAY((arr) => {
      arr.unshift(arr.pop() as ILETTER)
      return arr
    })
  }, [test])

  const handleEvent = (event: KeyboardEvent) => {
    const { key } = event
    setKeyDown(key)
    setKeyDown('')
  }

  useEffect(() => {
    window.addEventListener('keydown', (e) => {
      handleEvent(e)
    })

    return () => {
      window.removeEventListener('keydown', (e) => {
        handleEvent(e)
      })
    }
  }, [])

  return (
    <div className="flex flex-col font-courier">
      <div className="m-10 p-2 flex flex-row gap-2 rounded-full bg-red-200">
        <button
          className="bg-green-500 p-3 rounded-full"
          // onClick={() => handleSuccess}
        >
          SUCCESS
        </button>
        <button className="bg-green-500 p-3 rounded-full justify-self-end	">
          Renders: {rendersCount.current}
        </button>
        <button className="bg-green-500 p-3 rounded-full justify-self-end	">
          {keyDown}
        </button>
        <button className="bg-purple-500 p-3 rounded-full justify-self-end	">
          {test}
        </button>
        {lamp ? (
          <button className="bg-red-500 p-3 rounded-full justify-self-end	ml-auto">
            LAMP: {lamp}
          </button>
        ) : null}
      </div>

      <KBRD ARRAY={ARRAY} />
    </div>
  )
}
